# FastAPI Book Management API

## Overview

This project is a RESTful API built with FastAPI for managing a book collection. It provides comprehensive CRUD (Create, Read, Update, Delete) operations for books with proper error handling, input validation, and documentation.

## Features

- 📚 Book management (CRUD operations)
- ✅ Input validation using Pydantic models
- 🔍 Enum-based genre classification
- 🧪 Complete test coverage
- 📝 API documentation (auto-generated by FastAPI)
- 🔒 CORS middleware enabled

## Project Structure

```
fastapi-book-project/
├── api/
│   ├── db/
│   │   ├── __init__.py
│   │   └── schemas.py      # Data models and in-memory database
│   ├── routes/
│   │   ├── __init__.py
│   │   └── books.py        # Book route handlers
│   └── router.py           # API router configuration
├── core/
│   ├── __init__.py
│   └── config.py           # Application settings
├── tests/
│   ├── __init__.py
│   └── test_books.py       # API endpoint tests
├── main.py                 # Application entry point
├── requirements.txt        # Project dependencies
└── README.md
```

## Technologies Used

- Python 3.12
- FastAPI
- Pydantic
- pytest
- uvicorn

## Installation

1. Clone the repository:

```bash
git clone https://github.com/hng12-devbotops/fastapi-book-project.git
cd fastapi-book-project
```

2. Create a virtual environment:

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

3. Install dependencies:

```bash
pip install -r requirements.txt
```

## Running the Application

1. Start the server:

```bash
uvicorn main:app
```

2. Access the API documentation:

- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## API Endpoints

### Books

- `GET /api/v1/books/` - Get all books
- `GET /api/v1/books/{book_id}` - Get a specific book
- `POST /api/v1/books/` - Create a new book
- `PUT /api/v1/books/{book_id}` - Update a book
- `DELETE /api/v1/books/{book_id}` - Delete a book

### Health Check

- `GET /healthcheck` - Check API status

## Book Schema

```json
{
  "id": 1,
  "title": "Book Title",
  "author": "Author Name",
  "publication_year": 2024,
  "genre": "Fantasy"
}
```

Available genres:

- Science Fiction
- Fantasy
- Horror
- Mystery
- Romance
- Thriller

## Running Tests

```bash
pytest
```

## Error Handling

The API includes proper error handling for:

- Non-existent books
- Invalid book IDs
- Invalid genre types
- Malformed requests

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request


## Docker Setup and Deployment

1. Build the Docker image:

```bash
docker build -t fastapi-app .
```

2. Run the Docker container:

```bash
docker run -d -p 80:80 -p 8000:8000 fastapi-app
```

This will start your FastAPI application with Nginx as a reverse proxy, all managed by Supervisor inside the Docker container.

## Deployment to Azure Container Apps (ACA)

### Prerequisites

- Azure CLI installed and configured
- Azure Container Registry (ACR) created
- Azure credentials set up in GitHub Secrets

### Local setup and Deployment

1. **Get Variables ready:** Provision and Azure Container Instance (AC) and get variables for Azure Container Registry (ACR) name, login server, image name, resource group, ACI name, DNS name label, local port, ACR username, and password.
2. **Build Docker Image:** Build a Docker image with a specified name.
3. **Run Docker Container Locally:** Run the Docker container locally on the specified port.
4. **Test Locally:** Test the application locally by sending a request to `http://localhost`.
5. **Login to ACR:** Log into the Azure Container Registry.
6. **Tag Docker Image:** Tag the Docker image for pushing to ACR.
7. **Push Docker Image to ACR:** Push the Docker image to the Azure Container Registry.
8. **Deploy to ACA:** Deploy the Docker image to Azure Container Apps with specified resources and DNS name label.
9. **Test on ACA:** Test the application on ACA by sending a request to the deployed container's URL.

### Continuous Deployment (CD) Pipeline

The project includes a GitHub Actions workflow for continuous deployment. The workflow is triggered on PR merge to the `main` branch.

1. Ensure the following secrets are set in your GitHub repository settings:
   - `AZURE_CREDENTIALS`
   - `ACR_LOGIN_SERVER`
   - `ACR_USERNAME`
   - `ACR_PASSWORD`

2. The workflow file is located at `.github/workflows/cd.yml` and will automatically build, push, and deploy the Docker image to ACI.

### Accessing the Deployed Application

After deployment, the application will be accessible at the specified DNS name. This project is accessible at:

```bash
https://fastapi-app-book-project.prouddesert-dc701ba3.uksouth.azurecontainerapps.io/

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Support

For support, please open an issue in the GitHub repository.
